## 高层业务流程（High-level Business Processes）

| 子项       | 内容                                                                                         |
| -------- | ------------------------------------------------------------------------------------------ |
| **流程结构** | #todo 根据流程关系补充编号（包含业务活动的有序结构，建议编号与命名方式呈树状结构，如：P1、P1.1  ）                                                     |
| **流程名称** | 车位引导配置流程                                                                                   |
| **流程描述** | 管理员通过TUMS平台完成停车引导相关设备的配置与关联，实现车位引导功能。                                                      |
| **流程步骤** | 1. 添加寻车诱导设备<br>2. 配置停车库楼层地图<br>3. 停车场配置<br>4. 停车场参数配置<br>5. 车辆信息管理<br>6. 车位设置<br>7. 泊位记录查询 |
| **图示** | #todo 补充有惩恶业务流程图                                                         |


## 场景

### 场景 S1：管理员配置车位引导系统

| 项目   | 内容                                                                                         |
| ---- | ------------------------------------------------------------------------------------------ |
| 场景名称 | 管理员配置车位引导系统                                                                                |
| 简要描述 | 停车场管理员通过TUMS平台完成车位引导设备的添加、地图配置、车位绑定等初始设置                                                   |
| 相关用户 | 停车场管理员（系统用户）                                                                               |
| 前置条件 | 管理员拥有系统访问权限，TUMS平台已部署，车位相机和引导屏设备已安装接入网络                                                    |
| 触发事件 | 停车场新增车位引导业务或首次启用系统                                                                         |
| 主要流程 | 1. 管理员登录系统<br>2. 添加引导设备（选择分组、自动发现或远程添加）<br>3. 上传车库地图并配置楼层信息<br>4. 将车位与设备绑定<br>5. 保存配置并查看状态 |
| 后置条件 | 所有配置保存成功，系统已具备车位引导功能                                                                       |
| 异常路径 | - 添加设备失败：设备网络不通或重复<br>- 地图上传失败：格式不支持或超出大小限制                                                |

### 场景 S2：管理员处理“异物占位”报警

| 项目   | 内容                                                                                   |
| ---- | ------------------------------------------------------------------------------------ |
| 场景名称 | 管理员处理“异物占位”报警                                                                        |
| 简要描述 | 当车位相机识别到非车辆物体占用车位时，自动上报报警，管理员通过消息模块查看并处理该异常                                          |
| 相关用户 | 停车场管理员                                                                               |
| 前置条件 | 系统已部署，IPC设备支持异物检测算法，报警消息成功上报系统                                                       |
| 触发事件 | 某车位检测到异物，设备主动触发“异物占位”报警                                                              |
| 主要流程 | 1. 系统接收报警消息<br>2. 管理员登录平台，进入“消息模块”<br>3. 查看报警消息列表及详情<br>4. 查看抓拍图<br>5. 记录处理情况或转报值班人员 |
| 后置条件 | 报警记录被标记为已处理，相关图像被归档                                                                  |
| 异常路径 | - 报警图片缺失：设备异常或网络断连<br>- 报警误报：需支持手动撤销或添加备注说明                                          |

### 场景 S3：顾客入场寻车并停车

| 项目   | 内容                                                                   |
| ---- | -------------------------------------------------------------------- |
| 场景名称 | 顾客入场寻车并停车                                                            |
| 简要描述 | 顾客进入停车场后，通过余位引导屏和诱导屏指引快速到达空闲车位并完成停车                                  |
| 相关用户 | 停车场顾客/业主                                                             |
| 前置条件 | 系统配置完成并正常运行，引导屏能显示实时余位数据                                             |
| 触发事件 | 顾客驾驶车辆进入停车场入口                                                        |
| 主要流程 | 1. 顾客进入车场<br>2. 查看入口引导屏，选择有余位楼层<br>3. 上楼后根据区域诱导屏进入对应车位区域<br>4. 停入空车位 |
| 后置条件 | 车辆成功停入，车位状态变更为“已占用”，可视化数据更新至平台                                       |
| 异常路径 | - 顾客发现所指区域已满：需考虑数据更新频率与响应机制<br>- 设备屏幕损坏：应提供备用纸质引导或语音提示               |


## 功能性需求

> #todo 细化内容

| 编号  | 功能名称     | 功能描述                      | 输入项                     | 处理逻辑概述                   | 输出项              | 触发条件               |状态依赖|
| --- | -------- | ------------------------- | ----------------------- | ------------------------ | ---------------- | ------------------ | ------------------ |
| F1  | 添加设备     | 管理员向系统添加车位相机、引导屏等设备       | 设备ID、分组信息、添加方式（自动发现/远程） | 校验设备唯一性 → 建立与楼层/车位的绑定关系  | 设备列表更新、绑定关系建立    | 管理员点击“添加设备”        |  |
| F2  | 编辑/删除设备  | 支持对已添加设备进行编辑、删除           | 设备ID、新属性值               | 修改设备属性或解绑设备              | 操作成功提示，设备列表更新    | 管理员编辑或删除时触发        |  |
| F3  | 楼层地图配置   | 上传楼层地图图像并配置坐标用于车位引导定位     | 图片文件、楼层编号、车位点位          | 上传图像 → 记录点位与设备或车位关联      | 楼层地图显示、点位与实体绑定关系 | 管理员点击“地图配置”        |  |
| F4  | 车场信息维护   | 管理员维护停车场及其楼层的基础信息         | 车场名称、楼层数量、位置描述等         | 保存停车场与楼层结构信息             | 车场结构数据更新         | 管理员点击“新增车场/楼层”按钮   |  |
| F5  | 车位设置     | 设置每个车位的编号、类型、状态、对应设备等     | 楼层编号、车位编号、车位类型、绑定设备ID   | 根据楼层定位 → 添加/修改车位数据       | 更新后的车位列表及配置      | 管理员配置车位时触发         |  |
| F6  | 车辆信息管理   | 管理车牌与车位的绑定关系              | 车牌号、车牌类型、关联车位ID         | 校验车牌唯一 → 与车位绑定           | 车牌与车位映射信息        | 管理员新增/编辑车辆绑定       |  |
| F7  | 泊位记录查询   | 查询某时段内的停车/离开记录            | 筛选条件：车牌号、楼层、车场、时间段、车牌类型 | 根据条件检索数据库 → 返回结果列表       | 泊位记录列表显示         | 管理员点击“查询”          |  |
| F8  | 泊位记录导出   | 将查询结果导出为本地文件（部分或全部）       | 导出范围（选中/全部）             | 生成CSV/XLSX格式文件 → 提供下载链接  | 下载文件、导出记录列表更新    | 管理员点击“导出”          |  |
| F9  | 异物占位报警接收 | 系统接收车位相机上报的异常占位报警         | 异物检测事件（车位ID、时间、图片）      | 写入报警消息 → 通知管理员           | 报警消息记录、报警列表更新    | IPC设备触发“异物占位”      |  |
| F10 | 报警查看与处理  | 管理员查看报警消息和抓拍图，可添加备注、标记已处理 | 报警ID、处理备注               | 查询报警记录 → 显示抓拍图 → 更新处理状态  | 报警处理状态更新         | 管理员点击“查看报警”或“处理报警” |  |
| F11 | 引导信息发布   | 将空余车位信息实时推送至引导屏           | 系统自动统计空车位数据             | 每周期汇总 → 按区域/楼层分类 → 推送至设备 | 引导屏显示更新          | 周期任务（定时触发）         |  |
| F12 | 数据统计报表   | 对车位使用率、报警频次、停车时长等进行统计     | 起止时间、统计维度（楼层/区域）        | 汇总分析数据库 → 输出统计图表或明细表     | 报表文件、图表数据        | 管理员点击“统计分析”        |  |
| F13 | 权限控制     | 不同角色拥有不同功能权限（管理员、只读用户等）   | 用户角色、权限定义               | 登录后根据角色限制菜单与功能访问         | 可访问功能菜单、页面元素     | 用户登录成功后            |  |
| F14 | 系统操作日志记录 | 自动记录关键操作，如添加设备、导出数据、处理报警等 | 用户ID、操作类型、操作内容          | 每次操作生成操作记录并写入日志          | 操作日志条目           | 系统关键操作发生时          |  |
